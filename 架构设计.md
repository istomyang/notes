# 架构设计

## 理解

架构设计的主要目的是为了解决 软件系统复杂度带来的问题。比如学生管理系统，举一个方面，比如安全性，学生的照片不能泄漏，所以这个系统的复杂性就包括 安全 这一块。

架构设计复杂度：扩展、性能、可用、安全、成本、规模。

> 03-从0开始学架构 04/05/06/07

架构设计三个原则：合适、简单、演化。

> 03-从0开始学架构 08


## 高可用

CAP理论：对于一个分布式计算系统，不可能同时满足一致性（Consistence）、可用性（Availability）、分区容错性（Partition Tolerance）三个设计约束。

一致性：对某个指定的客户端来说，读操作保证能够返回最新的写操作结果。

可用性：非故障的节点在合理的时间内返回合理的响应（不是错误和超时的响应）。

分区容忍性：当出现网络分区（区域节点之间不可通信）后，系统能够继续“履行职责”。

放到分布式环境下来思考，我们会发现必须选择 P（分区容忍）要素，因为网络本身不能做到 100% 可靠。

CP：因为节点之间断开，所以为了一致性，只能返回错误，也就丢了 A。

AP：节点断开，但是为了 A 可以返回旧数据，丢了 C。

CAP关注的是数据，而不是系统。比如 同一个系统不同的数据要求不一样，有的是CP，有的是AP，所以可以区分开。

CAP是忽略网络延迟的，在分布式系统里做到 C一致性 很难。

正常运行的情况下，不会出现分区错误，可以同时满足 CA，哪怕发生了，也要为灾后恢复做好准备。最典型的就是日志，可以在系统恢复后迅速保证C。

> 03-从0开始学架构 22/23

---

ACID 是数据库管理系统为了保证事务的正确性而提出来的一个理论。

Atomicity（原子性）：要么全部完成，要么全部不完成，不会在中间某个环节结束。

Consistency（一致性）：事务开始之前和事务结束以后，数据库的完整性没有被破坏。

Isolation（隔离性）：数据库允许多个并发事务同时对数据进行读写和修改的能力。隔离性可以防止多个事务并发执行时由于交叉执行而导致数据的不一致。事务隔离分为不同级别，包括读未提交（Read uncommitted）、读提交（read committed）、可重复读（repeatable read）和串行化（Serializable）。

Durability（持久性）：事务处理结束后，对数据的修改就是永久的，即便系统故障也不会丢失。

---

BASE：指基本可用（Basically Available）、软状态（ Soft State）、最终一致性（ Eventual Consistency），核心思想是即使无法做到强一致性（CAP 的一致性就是强一致性），但应用可以采用适合的方式达到最终一致性。

基本可用：分布式系统在出现故障时，允许损失部分可用性，即保证核心可用。

软状态：允许系统存在中间状态（数据不一致），而该中间状态不会影响系统整体可用性。

最终一致性：系统中的所有数据副本经过一定时间后，最终能够达到一致的状态。

BASE 是 CAP 理论中 AP 方案的延伸。

> 03-从0开始学架构 23

FMEA（Failure mode and effects analysis，故障模式与影响分析）是一种在各行各业都有广泛应用的可用性分析方法，通过对系统范围内潜在的故障模式加以分析，并按照严重程度进行分类，以确定失效对于系统的最终影响。

FMEA 的具体分析方法是：
1. 给出初始的架构设计图。
2. 假设架构中某个部件发生故障。
3. 分析此故障对系统功能造成的影响。
4. 根据分析结果，判断架构是否需要进行优化。

> 03-从0开始学架构 24

